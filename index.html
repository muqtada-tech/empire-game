<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إمبراطورية المستقبل</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .stats {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        .stat-item {
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
        }
        .country-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .country-card {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.3s;
        }
        .corruption-fill {
            background-color: #e74c3c;
        }
        .army-fill {
            background-color: #34495e;
        }
        .event-log {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background-color: #f9f9f9;
            margin-bottom: 20px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tabs {
            display: flex;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .tab-btn {
            background-color: #95a5a6;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .tab-btn.active {
            background-color: #3498db;
        }
        .alliance-badge {
            background-color: #9b59b6;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            margin-left: 5px;
        }
        .audio-controls {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(255,255,255,0.8);
            padding: 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>إمبراطورية المستقبل</h1>
        
        <div class="stats">
            <div class="stat-item">
                <strong>الإمبراطورية:</strong> <span id="country-name">إمبراطوريتك</span>
            </div>
            <div class="stat-item">
                <strong>الذهب:</strong> <span id="gold">0</span>
                <div class="progress-bar"><div class="progress-fill" id="gold-bar"></div></div>
            </div>
            <div class="stat-item">
                <strong>الجيش:</strong> <span id="army">0</span>
                <div class="progress-bar"><div class="progress-fill army-fill" id="army-bar"></div></div>
            </div>
            <div class="stat-item">
                <strong>رضا الشعب:</strong> <span id="happiness">0</span>%
                <div class="progress-bar"><div class="progress-fill" id="happiness-bar"></div></div>
            </div>
            <div class="stat-item">
                <strong>الفساد:</strong> <span id="corruption">0</span>%
                <div class="progress-bar"><div class="progress-fill corruption-fill" id="corruption-bar"></div></div>
            </div>
            <div class="stat-item">
                <strong>الدول المحتلة:</strong> <span id="territories">0</span>
            </div>
            <div class="stat-item">
                <strong>التحالفات:</strong> <span id="alliances">0</span>
            </div>
            <div class="stat-item">
                <strong>الدور:</strong> <span id="turn">1</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('conquer')">الغزو</button>
            <button class="tab-btn" onclick="openTab('merge')">الدمج</button>
            <button class="tab-btn" onclick="openTab('alliances')">الدبلوماسية</button>
            <button class="tab-btn" onclick="openTab('military')">الجيش</button>
            <button class="tab-btn" onclick="openTab('research')">الأبحاث</button>
            <button class="tab-btn" onclick="openTab('economy')">الاقتصاد</button>
            <button class="tab-btn" onclick="openTab('anti-corruption')">مكافحة الفساد</button>
            <button class="tab-btn" onclick="openTab('save')">الحفظ والتحميل</button>
        </div>
        
        <div id="conquer" class="tab-content active">
            <h3>الدول المتاحة للاحتلال</h3>
            <div class="country-list" id="countries-list"></div>
            <button onclick="endTurn()">إنهاء الدور</button>
            <button onclick="cleanTurn()">تنظيف الدور</button>
        </div>
        
        <div id="merge" class="tab-content">
            <h3>الدول المحتلة القابلة للدمج</h3>
            <div class="country-list" id="merge-list"></div>
        </div>
        
        <div id="alliances" class="tab-content">
            <h3>الدبلوماسية والتحالفات</h3>
            <div class="country-list" id="alliances-list"></div>
            <div id="diplomacy-options"></div>
        </div>
        
        <div id="military" class="tab-content">
            <h3>تطوير الجيش</h3>
            <div id="military-options"></div>
        </div>
        
        <div id="research" class="tab-content">
            <h3>أبحاث التكنولوجيا</h3>
            <div id="research-options"></div>
        </div>
        
        <div id="economy" class="tab-content">
            <h3>الاستثمارات الاقتصادية</h3>
            <div id="economy-options"></div>
        </div>
        
        <div id="anti-corruption" class="tab-content">
            <h3>مكافحة الفساد</h3>
            <div id="corruption-options"></div>
        </div>
        
        <div id="save" class="tab-content">
            <h3>حفظ وتحميل اللعبة</h3>
            <button onclick="saveGame()">حفظ اللعبة</button>
            <button onclick="loadGame()">تحميل اللعبة</button>
            <div id="save-status"></div>
        </div>
        
        <h3>سجل الأحداث</h3>
        <div class="event-log" id="event-log"></div>
    </div>

    <div class="audio-controls">
        <button onclick="toggleMusic()">تشغيل/إيقاف الموسيقى</button>
        <audio id="game-music" loop>
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script>
        // بيانات اللعبة
        const game = {
            player: {
                name: "إمبراطوريتك",
                gold: 50000,
                army: 10000,
                armyTech: 1,
                peopleHappiness: 70,
                corruption: 20,
                territories: [],
                alliances: [],
                technologies: {
                    ai: 0,
                    robotics: 0,
                    biotech: 0,
                    energy: 0,
                    diplomacy: 0
                },
                economyBonuses: [],
                militaryBonuses: [],
                lastMerge: null,
                relations: {}
            },
            countries: [],
            currentTurn: 1,
            events: [],
            countryNames: [
                "أطلانطس", "نيون", "كاليبسو", "أوليمبوس", "فالهالا", 
                "ألفا", "بيتا", "غاما", "إيليسيوم", "أندورا",
                "نوفا", "تيرا", "إكسبانسيا", "دلتا", "سايبر"
            ],
            musicTracks: [
                "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
            ]
        };

        // تهيئة اللعبة
        function initGame() {
            const playerName = prompt("ادخل اسم إمبراطوريتك:", "إمبراطوريتك");
            if (playerName) game.player.name = playerName;
            
            generateCountries(100);
            game.player.territories.push(game.player);
            
            // بدء الموسيقى
            const audio = document.getElementById("game-music");
            audio.volume = 0.3;
            audio.src = randomChoice(game.musicTracks);
            
            updateUI();
            addEvent(`بدأت لعبة جديدة: ${game.player.name}!`);
        }

        // توليد الدول
        function generateCountries(count) {
            for (let i = 0; i < count; i++) {
                const name = `${randomChoice(game.countryNames)}-${randomInt(1, 1000)}`;
                const country = {
                    id: generateId(),
                    name,
                    power: randomChoice(["قوية", "متوسطة", "ضعيفة"]),
                    gold: randomInt(1000, 100000),
                    army: randomInt(1000, 50000),
                    armyTech: randomInt(1, 3),
                    peopleHappiness: randomInt(30, 80),
                    corruption: randomInt(5, 30),
                    relations: {},
                    alliance: null
                };
                game.countries.push(country);
            }
        }

        // إضافة دول جديدة
        function addNewCountries(count) {
            for (let i = 0; i < count; i++) {
                const name = `${randomChoice(["نوفا", "تيرا", "إكسبانسيا", "دلتا", "سايبر"])}-${randomInt(1001, 9999)}`;
                const country = {
                    id: generateId(),
                    name,
                    power: randomChoice(["قوية", "متوسطة", "ضعيفة"]),
                    gold: randomInt(1000, 100000),
                    army: randomInt(1000, 50000),
                    armyTech: randomInt(1, 3),
                    peopleHappiness: randomInt(30, 80),
                    corruption: randomInt(5, 30),
                    relations: {},
                    alliance: null
                };
                game.countries.push(country);
                addEvent(`ظهرت دولة جديدة: ${name} (${country.power})`);
            }
            updateUI();
        }

        // تحديث واجهة المستخدم
        function updateUI() {
            document.getElementById("country-name").textContent = game.player.name;
            document.getElementById("gold").textContent = game.player.gold.toLocaleString();
            document.getElementById("army").textContent = game.player.army.toLocaleString();
            document.getElementById("happiness").textContent = game.player.peopleHappiness;
            document.getElementById("corruption").textContent = game.player.corruption;
            document.getElementById("territories").textContent = game.player.territories.length - 1;
            document.getElementById("alliances").textContent = game.player.alliances.length;
            document.getElementById("turn").textContent = game.currentTurn;
            
            // تحديث أشرطة التقدم
            document.getElementById("gold-bar").style.width = `${Math.min(100, game.player.gold / 100000)}%`;
            document.getElementById("army-bar").style.width = `${Math.min(100, game.player.army / 50000)}%`;
            document.getElementById("happiness-bar").style.width = `${game.player.peopleHappiness}%`;
            document.getElementById("corruption-bar").style.width = `${game.player.corruption}%`;
            
            // تحديث القوائم
            updateCountriesList();
            updateMergeList();
            updateAlliancesList();
            updateDiplomacyOptions();
            updateMilitaryOptions();
            updateResearchOptions();
            updateEconomyOptions();
            updateCorruptionOptions();
        }

        // تحديث قائمة الدول للاحتلال
        function updateCountriesList() {
            const countriesList = document.getElementById("countries-list");
            countriesList.innerHTML = "";
            
            const availableCountries = game.countries.filter(c => 
                !game.player.territories.includes(c) && 
                c !== game.player &&
                !game.player.alliances.includes(c.id)
            ).slice(0, 10);
            
            if (availableCountries.length === 0) {
                countriesList.innerHTML = "<p>لا توجد دول متاحة للاحتلال حالياً</p>";
                return;
            }
            
            availableCountries.forEach((country, index) => {
                const card = document.createElement("div");
                card.className = "country-card";
                
                let allianceBadge = "";
                if (country.alliance) {
                    allianceBadge = `<span class="alliance-badge">تحالف</span>`;
                }
                
                card.innerHTML = `
                    <h4>${country.name} ${allianceBadge}</h4>
                    <p><strong>القوة:</strong> ${country.power}</p>
                    <p><strong>الجيش:</strong> ${country.army.toLocaleString()} (تكنولوجيا: ${country.armyTech})</p>
                    <p><strong>الذهب:</strong> ${country.gold.toLocaleString()}</p>
                    <button onclick="conquerCountry('${country.id}')">احتلال</button>
                    <button onclick="showDiplomacyOptions('${country.id}')">دبلوماسية</button>
                `;
                countriesList.appendChild(card);
            });
        }

        // تحديث قائمة الدول للدمج
        function updateMergeList() {
            const mergeList = document.getElementById("merge-list");
            mergeList.innerHTML = "";
            
            const mergeableCountries = game.player.territories.filter(c => 
                c !== game.player && 
                (game.player.lastMerge === null || game.currentTurn - game.player.lastMerge >= 5)
            );
            
            if (mergeableCountries.length === 0) {
                mergeList.innerHTML = "<p>لا توجد دول قابلة للدمج حالياً</p>";
                return;
            }
            
            mergeableCountries.forEach((country, index) => {
                const card = document.createElement("div");
                card.className = "country-card";
                card.innerHTML = `
                    <h4>${country.name}</h4>
                    <p><strong>الجيش:</strong> ${country.army.toLocaleString()}</p>
                    <p><strong>الذهب:</strong> ${country.gold.toLocaleString()}</p>
                    <button onclick="mergeCountry('${country.id}')">دمج</button>
                `;
                mergeList.appendChild(card);
            });
        }

        // تحديث قائمة التحالفات
        function updateAlliancesList() {
            const alliancesList = document.getElementById("alliances-list");
            alliancesList.innerHTML = "";
            
            const alliedCountries = game.countries.filter(c => 
                game.player.alliances.includes(c.id)
            );
            
            if (alliedCountries.length === 0) {
                alliancesList.innerHTML = "<p>ليس لديك أي تحالفات حالياً</p>";
                return;
            }
            
            alliedCountries.forEach(country => {
                const card = document.createElement("div");
                card.className = "country-card";
                card.innerHTML = `
                    <h4>${country.name}</h4>
                    <p><strong>القوة:</strong> ${country.power}</p>
                    <p><strong>الجيش:</strong> ${country.army.toLocaleString()}</p>
                    <button onclick="breakAlliance('${country.id}')">فسخ التحالف</button>
                `;
                alliancesList.appendChild(card);
            });
        }

        // تحديث خيارات الدبلوماسية
        function updateDiplomacyOptions() {
            const diplomacyOptions = document.getElementById("diplomacy-options");
            diplomacyOptions.innerHTML = "";
            
            const options = [
                {
                    name: "تحسين العلاقات",
                    cost: 2000,
                    effect: "زيادة العلاقات مع دولة معينة",
                    action: "improveRelations"
                },
                {
                    name: "عقد معاهدة تجارية",
                    cost: 5000,
                    effect: "تبادل تجاري يزيد دخلك",
                    action: "tradeAgreement"
                },
                {
                    name: "تحالف عسكري",
                    cost: 8000,
                    effect: "مساعدة عسكرية في الحروب",
                    action: "militaryAlliance"
                }
            ];
            
            options.forEach(opt => {
                const btn = document.createElement("button");
                btn.innerHTML = `
                    ${opt.name}<br>
                    <small>${opt.effect}</small><br>
                    التكلفة: ${opt.cost} ذهب
                `;
                btn.onclick = () => prepareDiplomaticAction(opt.action);
                btn.disabled = game.player.gold < opt.cost;
                diplomacyOptions.appendChild(btn);
            });
        }

        // تحديث خيارات الجيش
        function updateMilitaryOptions() {
            const militaryOptions = document.getElementById("military-options");
            militaryOptions.innerHTML = "";
            
            const options = [
                {
                    name: "تجنيد جنود",
                    cost: 1000,
                    effect: 1000,
                    desc: "إضافة 1000 جندي إلى جيشك"
                },
                {
                    name: "تدريب متقدم",
                    cost: 5000,
                    effect: 0.2,
                    desc: "زيادة كفاءة الجيش 20%"
                },
                {
                    name: "تطوير تكنولوجيا عسكرية",
                    cost: 10000,
                    effect: 1,
                    desc: "زيادة مستوى التكنولوجيا العسكرية"
                },
                {
                    name: "شراء أسلحة متطورة",
                    cost: 15000,
                    effect: 3000,
                    desc: "إضافة 3000 جندي مدججين بالسلاح"
                }
            ];
            
            options.forEach((opt, index) => {
                const card = document.createElement("div");
                card.className = "country-card";
                card.innerHTML = `
                    <h4>${opt.name}</h4>
                    <p>${opt.desc}</p>
                    <p><strong>التكلفة:</strong> ${opt.cost} ذهب</p>
                    <button onclick="militaryAction(${index})">تنفيذ</button>
                `;
                card.querySelector("button").disabled = game.player.gold < opt.cost;
                militaryOptions.appendChild(card);
            });
        }

        // تحديث خيارات الأبحاث
        function updateResearchOptions() {
            const researchOptions = document.getElementById("research-options");
            researchOptions.innerHTML = "";
            
            const techs = [
                { id: "ai", name: "الذكاء الاصطناعي", cost: 5000, desc: "يحسن كفاءة جميع المجالات" },
                { id: "robotics", name: "الروبوتات", cost: 4000, desc: "يزيد من قوة الجيش والإنتاج" },
                { id: "biotech", name: "التكنولوجيا الحيوية", desc: "تحسن صحة الشعب والإنتاج الزراعي", cost: 6000 },
                { id: "energy", name: "الطاقة المتجددة", desc: "يقلل التكاليف ويزيد الإنتاج", cost: 3000 },
                { id: "diplomacy", name: "الدبلوماسية", desc: "يحسن العلاقات مع الدول الأخرى", cost: 4000 }
            ];
            
            techs.forEach(tech => {
                const level = game.player.technologies[tech.id] || 0;
                const card = document.createElement("div");
                card.className = "country-card";
                card.innerHTML = `
                    <h4>${tech.name} (المستوى ${level}/10)</h4>
                    <p>${tech.desc}</p>
                    <p><strong>التكلفة:</strong> ${tech.cost * (level + 1)} ذهب</p>
                    <button onclick="researchTechnology('${tech.id}', '${tech.name}', ${tech.cost * (level + 1)})">
                        تطوير
                    </button>
                `;
                card.querySelector("button").disabled = game.player.gold < tech.cost * (level + 1) || level >= 10;
                researchOptions.appendChild(card);
            });
        }

        // تحديث خيارات الاقتصاد
        function updateEconomyOptions() {
            const economyOptions = document.getElementById("economy-options");
            economyOptions.innerHTML = "";
            
            const investments = [
                { name: "بنك استثماري", cost: 10000, income: 500, desc: "ربح يومي ثابت" },
                { name: "مدينة ذكية", cost: 20000, income: 1000, desc: "يزيد السعادة والاقتصاد" },
                { name: "مزارع عمودية", cost: 15000, income: 700, desc: "توقف المجاعات" },
                { name: "تعدين الكويكبات", cost: 50000, income: 2500, desc: "موارد لا تنضب" },
                { name: "شبكة مواصلات", cost: 30000, income: 1200, desc: "تحسن التجارة الداخلية" },
                { name: "منصة نفطية", cost: 40000, income: 2000, desc: "إنتاج نفطي ضخم" }
            ];
            
            investments.forEach((inv, index) => {
                const card = document.createElement("div");
                card.className = "country-card";
                card.innerHTML = `
                    <h4>${inv.name}</h4>
                    <p>${inv.desc}</p>
                    <p><strong>التكلفة:</strong> ${inv.cost} ذهب</p>
                    <p><strong>الربح:</strong> ${inv.income} ذهب/يوم</p>
                    <button onclick="buyInvestment(${index})">شراء</button>
                `;
                card.querySelector("button").disabled = game.player.gold < inv.cost;
                economyOptions.appendChild(card);
            });
        }

        // تحديث خيارات مكافحة الفساد
        function updateCorruptionOptions() {
            const corruptionOptions = document.getElementById("corruption-options");
            corruptionOptions.innerHTML = "";
            
            const options = [
                { name: "محاكم مستقلة", cost: 3000, effect: -20, desc: "تخفض الفساد بشكل كبير" },
                { name: "حملات توعية", cost: 2000, effect: -15, desc: "تحسن صورة الحكومة" },
                { name: "تفتيش مفاجئ", cost: 1000, effect: -10, desc: "إجراءات سريعة ضد الفساد" },
                { name: "نظام رقابة", cost: 5000, effect: -25, desc: "منع الفساد قبل حدوثه" }
            ];
            
            options.forEach((opt, index) => {
                const card = document.createElement("div");
                card.className = "country-card";
                card.innerHTML = `
                    <h4>${opt.name}</h4>
                    <p>${opt.desc}</p>
                    <p><strong>التكلفة:</strong> ${opt.cost} ذهب</p>
                    <p><strong>التأثير:</strong> ${opt.effect}% فساد</p>
                    <button onclick="antiCorruptionAction(${index})">تنفيذ</button>
                `;
                card.querySelector("button").disabled = game.player.gold < opt.cost;
                corruptionOptions.appendChild(card);
            });
        }

        // إضافة حدث للسجل
        function addEvent(message) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            game.events.push(`[${timeStr}] ${message}`);
            
            const eventLog = document.getElementById("event-log");
            eventLog.innerHTML = game.events.map(e => `<div>${e}</div>`).join("");
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        // تغيير التبويبات
        function openTab(tabId) {
            document.querySelectorAll(".tab-content").forEach(tab => {
                tab.classList.remove("active");
            });
            document.querySelectorAll(".tab-btn").forEach(btn => {
                btn.classList.remove("active");
            });
            
            document.getElementById(tabId).classList.add("active");
            document.querySelector(`.tab-btn[onclick="openTab('${tabId}')"]`).classList.add("active");
        }

        // احتلال دولة
        function conquerCountry(countryId) {
            const target = game.countries.find(c => c.id === countryId);
            if (!target) return;
            
            // حساب قوة الجيش مع التكنولوجيا
            const playerPower = game.player.army * game.player.armyTech;
            const targetPower = target.army * target.armyTech;
            
            if (playerPower > targetPower * 1.3) {
                game.player.territories.push(target);
                
                // إذا كانت الدولة في تحالف، يغضب الحلفاء
                if (target.alliance) {
                    const allies = game.countries.filter(c => c.alliance === target.alliance && c.id !== target.id);
                    allies.forEach(ally => {
                        addEvent(`تحذير: ${ally.name} غاضبة من احتلال حليفها!`);
                        ally.relations[game.player.name] = (ally.relations[game.player.name] || 0) - 30;
                    });
                }
                
                addEvent(`لقد احتلت ${target.name} بنجاح!`);
                addNewCountries(10);
                
                // زيادة الفساد مع كل احتلال
                game.player.corruption = Math.min(100, game.player.corruption + 5);
                
                updateUI();
                checkGameOver();
            } else {
                addEvent("جيشك ليس قوياً بما يكفي للاحتلال!");
                
                // خسائر الجيش
                const losses = Math.floor(game.player.army * 0.1);
                game.player.army = Math.max(0, game.player.army - losses);
                addEvent(`خسرت ${losses} جندي في المعركة!`);
                
                updateUI();
            }
        }

        // دمج دولة
        function mergeCountry(countryId) {
            const target = game.player.territories.find(c => c.id === countryId);
            if (!target || target === game.player) return;
            
            const cost = Math.floor(target.gold * 0.1);
            
            if (game.player.gold >= cost) {
                game.player.gold -= cost;
                game.player.army += Math.floor(target.army * 0.7);
                game.player.gold += Math.floor(target.gold * 0.8);
                game.player.peopleHappiness = Math.min(100, game.player.peopleHappiness + 5);
                game.player.lastMerge = game.currentTurn;
                
                // إزالة الدولة من الأقاليم بعد دمجها
                game.player.territories = game.player.territories.filter(c => c !== target);
                game.countries = game.countries.filter(c => c !== target);
                
                addEvent(`تم دمج ${target.name} تماماً مع إمبراطوريتك!`);
                updateUI();
            } else {
                addEvent(`تحتاج ${cost} ذهب لدمج هذه الدولة`);
            }
        }

        // إظهار خيارات الدبلوماسية لدولة معينة
        function showDiplomacyOptions(countryId) {
            currentDiplomacyTarget = countryId;
            openTab('alliances');
        }

        // تحضير إجراء دبلوماسي
        function prepareDiplomaticAction(actionType) {
            const targetId = prompt("ادخل ID الدولة (يمكنك الحصول عليه من صفحة الغزو):");
            if (!targetId) return;
            
            const target = game.countries.find(c => c.id === targetId);
            if (!target) {
                alert("الدولة غير موجودة!");
                return;
            }
            
            if (target === game.player) {
                alert("لا يمكن تنفيذ هذا الإجراء على نفسك!");
                return;
            }
            
            if (game.player.territories.includes(target)) {
                alert("هذه الدولة محتلة بالفعل!");
                return;
            }
            
            switch(actionType) {
                case "improveRelations":
                    improveRelations(targetId);
                    break;
                case "tradeAgreement":
                    tradeAgreement(targetId);
                    break;
                case "militaryAlliance":
                    militaryAlliance(targetId);
                    break;
            }
        }

        // تحسين العلاقات
        function improveRelations(countryId) {
            const target = game.countries.find(c => c.id === countryId);
            if (!target) return;
            
            const cost = 2000;
            if (game.player.gold >= cost) {
                game.player.gold -= cost;
                target.relations[game.player.name] = (target.relations[game.player.name] || 0) + 20;
                addEvent(`تحسنت العلاقات مع ${target.name}! العلاقة الآن: ${target.relations[game.player.name] || 0}`);
                updateUI();
            } else {
                addEvent("لا تملك ما يكفي من الذهب!");
            }
        }

        // معاهدة تجارية
        function tradeAgreement(countryId) {
            const target = game.countries.find(c => c.id === countryId);
            if (!target) return;
            
            const cost = 5000;
            if (game.player.gold >= cost) {
                game.player.gold -= cost;
                
                // كل طرف يحصل على 10% من تجارة الطرف الآخر
                const playerIncome = Math.floor(target.gold * 0.1);
                const targetIncome = Math.floor(game.player.gold * 0.1);
                
                game.player.economyBonuses.push({
                    name: `تجارة مع ${target.name}`,
                    type: "daily_income",
                    amount: playerIncome
                });
                
                target.gold += targetIncome;
                
                addEvent(`تم توقيع معاهدة تجارية مع ${target.name}! ستحصل على ${playerIncome} ذهب يومياً`);
                updateUI();
            } else {
                addEvent("لا تملك ما يكفي من الذهب!");
            }
        }

        // تحالف عسكري
        function militaryAlliance(countryId) {
            const target = game.countries.find(c => c.id === countryId);
            if (!target) return;
            
            const cost = 8000;
            if (game.player.gold >= cost) {
                if (target.relations[game.player.name] < 50) {
                    addEvent(`علاقتك مع ${target.name} ليست جيدة بما يكفي للتحالف! (تحتاج 50)`);
                    return;
                }
                
                game.player.gold -= cost;
                
                // إنشاء تحالف جديد إذا لم يكن لديهم تحالف
                if (!target.alliance) {
                    const allianceId = generateId();
                    target.alliance = allianceId;
                    game.player.alliances.push(target.id);
                    addEvent(`تم تشكيل تحالف جديد مع ${target.name}!`);
                } else {
                    // الانضمام إلى تحالف موجود
                    game.player.alliances.push(target.id);
                    addEvent(`انضممت إلى تحالف ${target.name}!`);
                }
                
                updateUI();
            } else {
                addEvent("لا تملك ما يكفي من الذهب!");
            }
        }

        // فسخ تحالف
        function breakAlliance(countryId) {
            const target = game.countries.find(c => c.id === countryId);
            if (!target) return;
            
            game.player.alliances = game.player.alliances.filter(id => id !== countryId);
            target.relations[game.player.name] = (target.relations[game.player.name] || 0) - 30;
            
            addEvent(`فسخت التحالف مع ${target.name}! العلاقة الآن: ${target.relations[game.player.name] || 0}`);
            updateUI();
        }

        // إجراء عسكري
        function militaryAction(index) {
            const options = [
                { name: "تجنيد جنود", cost: 1000, effect: 1000, type: "addSoldiers" },
                { name: "تدريب متقدم", cost: 5000, effect: 0.2, type: "training" },
                { name: "تطوير تكنولوجيا عسكرية", cost: 10000, effect: 1, type: "tech" },
                { name: "شراء أسلحة متطورة", cost: 15000, effect: 3000, type: "advancedWeapons" }
            ];
            
            const opt = options[index];
            if (!opt) return;
            
            if (game.player.gold >= opt.cost) {
                game.player.gold -= opt.cost;
                
                switch(opt.type) {
                    case "addSoldiers":
                        game.player.army += opt.effect;
                        addEvent(`تم تجنيد ${opt.effect} جندي جديد!`);
                        break;
                    case "training":
                        game.player.militaryBonuses.push({
                            name: "تدريب متقدم",
                            type: "efficiency",
                            amount: opt.effect
                        });
                        addEvent(`تحسن تدريب الجيش بنسبة ${opt.effect * 100}%!`);
                        break;
                    case "tech":
                        game.player.armyTech += opt.effect;
                        addEvent(`تم تطوير التكنولوجيا العسكرية إلى المستوى ${game.player.armyTech}!`);
                        break;
                    case "advancedWeapons":
                        game.player.army += opt.effect;
                        addEvent(`تمت إضافة ${opt.effect} جندي مدججين بالسلاح!`);
                        break;
                }
                
                updateUI();
            } else {
                addEvent("لا تملك ما يكفي من الذهب!");
            }
        }

        // البحث التكنولوجي
        function researchTechnology(techId, techName, cost) {
            if (game.player.gold >= cost && (game.player.technologies[techId] || 0) < 10) {
                game.player.gold -= cost;
                game.player.technologies[techId] = (game.player.technologies[techId] || 0) + 1;
                addEvent(`تم تطوير ${techName} إلى المستوى ${game.player.technologies[techId]}`);
                
                // تأثيرات خاصة للتكنولوجيا
                if (techId === "ai") {
                    game.player.economyBonuses.push({
                        name: "الذكاء الاصطناعي",
                        type: "daily_income",
                        amount: 200 * game.player.technologies.ai
                    });
                }
                
                updateUI();
            }
        }

        // شراء استثمار اقتصادي
        function buyInvestment(index) {
            const investments = [
                { name: "بنك استثماري", cost: 10000, income: 500 },
                { name: "مدينة ذكية", cost: 20000, income: 1000 },
                { name: "مزارع عمودية", cost: 15000, income: 700 },
                { name: "تعدين الكويكبات", cost: 50000, income: 2500 },
                { name: "شبكة مواصلات", cost: 30000, income: 1200 },
                { name: "منصة نفطية", cost: 40000, income: 2000 }
            ];
            
            if (index >= 0 && index < investments.length) {
                const inv = investments[index];
                
                if (game.player.gold >= inv.cost) {
                    game.player.gold -= inv.cost;
                    game.player.economyBonuses.push({
                        name: inv.name,
                        type: "daily_income",
                        amount: inv.income
                    });
                    addEvent(`تم إنشاء ${inv.name}! ستحصل على ${inv.income} ذهب يومياً`);
                    updateUI();
                } else {
                    addEvent("لا تملك ما يكفي من الذهب!");
                }
            }
        }

        // إجراء مكافحة الفساد
        function antiCorruptionAction(index) {
            const options = [
                { name: "محاكم مستقلة", cost: 3000, effect: -20 },
                { name: "حملات توعية", cost: 2000, effect: -15 },
                { name: "تفتيش مفاجئ", cost: 1000, effect: -10 },
                { name: "نظام رقابة", cost: 5000, effect: -25 }
            ];
            
            if (index >= 0 && index < options.length) {
                const opt = options[index];
                
                if (game.player.gold >= opt.cost) {
                    game.player.gold -= opt.cost;
                    game.player.corruption = Math.max(0, game.player.corruption + opt.effect);
                    addEvent(`تم تنفيذ ${opt.name}. الفساد الآن: ${game.player.corruption}%`);
                    updateUI();
                } else {
                    addEvent("لا تملك ما يكفي من الذهب!");
                }
            }
        }

        // تنظيف الدور
        function cleanTurn() {
            addEvent("تم تنظيف البيانات القديمة وتحديث النظام");
            if (game.events.length > 50) {
                game.events = game.events.slice(-50);
            }
            updateUI();
        }

        // إنهاء الدور
        function endTurn() {
            // تطبيق المكافآت الاقتصادية
            game.player.economyBonuses.forEach(bonus => {
                if (bonus.type === "daily_income") {
                    game.player.gold += bonus.amount;
                    addEvent(`ربح يومي من ${bonus.name}: +${bonus.amount} ذهب`);
                }
            });
            
            // دخل من الأقاليم
            game.player.territories.forEach(territory => {
                if (territory !== game.player) {
                    const income = Math.floor(territory.gold * 0.2);
                    game.player.gold += income;
                    territory.gold -= income;
                }
            });
            
            // تأثيرات التكنولوجيا
            if (game.player.technologies.ai > 0) {
                const aiBonus = 100 * game.player.technologies.ai;
                game.player.gold += aiBonus;
                addEvent(`مكاسب الذكاء الاصطناعي: +${aiBonus} ذهب`);
            }
            
            // أحداث عشوائية
            if (Math.random() < 0.3) {
                const randomEvents = [
                    "زيادة في أسعار النفط العالمية!",
                    "كارثة طبيعية تضرب إحدى الدول المجاورة",
                    "اكتشاف موارد جديدة في أراضيك",
                    "زيادة في معدلات البطالة",
                    "تظاهرات سلمية تطالب بإصلاحات",
                    "اختراق تكنولوجي في أحد مختبراتك"
                ];
                addEvent(randomChoice(randomEvents));
            }
            
            // زيادة الفساد مع الوقت
            if (Math.random() < 0.4) {
                const corruptionIncrease = randomInt(1, 3);
                game.player.corruption = Math.min(100, game.player.corruption + corruptionIncrease);
                addEvent(`ارتفاع في معدل الفساد: +${corruptionIncrease}%`);
            }
            
            game.currentTurn++;
            updateUI();
            checkGameOver();
        }

        // التحقق من نهاية اللعبة
        function checkGameOver() {
            // الخسارة
            if (game.player.corruption >= 70) {
                alert("لقد فشلت! الفساد أدى إلى ثورة شعبية ضدك!");
                return true;
            }
            
            if (game.player.peopleHappiness <= 20) {
                alert("لقد فشلت! الشعب يثور ضد حكمك!");
                return true;
            }
            
            if (game.player.army <= 0) {
                alert("لقد فشلت! جيشك انهار!");
                return true;
            }
            
            // الفوز
            if (game.player.territories.length >= game.countries.length * 0.8) {
                alert("مبروك! لقد سيطرت على العالم كله!");
                return true;
            }
            
            return false;
        }

        // حفظ اللعبة
        function saveGame() {
            const saveData = {
                player: game.player,
                countries: game.countries,
                currentTurn: game.currentTurn,
                events: game.events.slice(-50)
            };
            
            localStorage.setItem("empireGameSave", JSON.stringify(saveData));
            document.getElementById("save-status").innerHTML = "تم حفظ اللعبة بنجاح!";
            addEvent("تم حفظ تقدمك في اللعبة");
        }

        // تحميل اللعبة
        function loadGame() {
            const saveData = localStorage.getItem("empireGameSave");
            if (!saveData) {
                document.getElementById("save-status").innerHTML = "لا يوجد حفظ سابق!";
                return;
            }
            
            try {
                const loadedData = JSON.parse(saveData);
                
                game.player = loadedData.player;
                game.countries = loadedData.countries;
                game.currentTurn = loadedData.currentTurn;
                game.events = loadedData.events || [];
                
                document.getElementById("save-status").innerHTML = "تم تحميل اللعبة بنجاح!";
                addEvent("تم تحميل حفظ سابق");
                updateUI();
            } catch (e) {
                document.getElementById("save-status").innerHTML = "خطأ في تحميل الحفظ!";
                console.error(e);
            }
        }

        // التحكم بالموسيقى
        function toggleMusic() {
            const audio = document.getElementById("game-music");
            if (audio.paused) {
                audio.play();
                addEvent("تشغيل الموسيقى");
            } else {
                audio.pause();
                addEvent("إيقاف الموسيقى");
            }
        }

        // تغيير الموسيقى
        function changeMusic() {
            const audio = document.getElementById("game-music");
            audio.src = randomChoice(game.musicTracks);
            audio.play();
            addEvent("تغيير الموسيقى");
        }

        // وظائف مساعدة
        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }
        
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // بدء اللعبة
        window.onload = initGame;
    </script>
</body>
</html>